Orden Ejecución,Fase Estratégica,ID,Bloque,Tarea,Prioridad,Estado,Horas Est.,Flujo Maestro,Aprendizaje Clave,Prompt Maestro / Referencia,Descripción Detallada,Nivel de Dificultad,Justificación Modelo,Estrategia Detallada de Ejecución,Correciones pendientes
1,Fase 1: Ingesta (El Ojo),1.01,01 Cimientos,Init Next.js 16.1 & TS,Alta,Listo,3.0,Terminal + Chat,Turbopack Stable,"PROMPT: Create Next.js 16.1 project with TS, Tailwind, and App Router. Enable Turbopack and React 19 features.",Inicialización del entorno de desarrollo utilizando Next.js 16.1 (versión experimental o estable más reciente) junto con TypeScript. Se configura el 'App Router' para el enrutamiento moderno y se habilita 'Turbopack' para acelerar la compilación en desarrollo. El objetivo es tener una base sólida que soporte las nuevas características de React 19 como Server Actions y useOptimistic.,Media,Mejor capacidad para generar boilerplate moderno de Next.js 16.1 y configuraciones limpias de TypeScript.,Iniciar proyecto limpio. No requiere contexto previo. Usar 'Agent' para ejecutar los comandos de terminal y configurar 'next.config.ts'.,
2,Fase 1: Ingesta (El Ojo),1.02,01 Cimientos,Shadcn/UI v2 Setup,Alta,Listo,3.0,Composer Directo,Modern UI Library,PROMPT: Generate a legal-themed dashboard shell with shadcn/ui v2 for Next.js 16 Server Actions.,"Instalación y configuración de la biblioteca de componentes Shadcn/UI v2. Esta tarea implica usar Cursor Composer para generar una estructura base (shell) de la aplicación que tenga una estética profesional y sobria, adecuada para el sector legal. Se personalizarán los temas (theme) para reflejar seriedad y confianza.",Media,Líder indiscutible en UI/UX y generación de código React/Tailwind visualmente coherente.,Usar Composer para iterar visualmente sobre los componentes shadcn/ui. El foco es estético.,
3,Fase 1: Ingesta (El Ojo),4.01,04 Scraper,Extension Init (V3),Alta,Listo,6.0,Chrome API,SidePanel API 2026,PROMPT: Init Chrome Extension Manifest V3 with a sidePanel that activates on pjud.cl domain. This is the MAIN product interface.,"Inicialización del proyecto de Extensión de Chrome bajo el estándar Manifest V3. COMPONENTE PRINCIPAL DEL PRODUCTO: Se configura el permiso 'sidePanel' para que la extensión abra un panel lateral automáticamente o mediante clic cuando el usuario navega por el dominio 'pjud.cl' (Poder Judicial). Esta Extensión/Sidepanel es la interfaz principal donde el abogado realiza todo su trabajo: scraping de causas, análisis con IA, generación de escritos. El Dashboard Web es solo un panel administrativo secundario.",Media,La extensión es la cara del producto. Requiere el código frontend más robusto y moderno para el SidePanel.,Activar MAX Mode para que entienda el contexto de la aplicación web existente al crear la extensión. Evita duplicidad de utilidades.,
4,Fase 1: Ingesta (El Ojo),1.03,01 Cimientos,Supabase Auth & Config,Alta,Listo,2.0,Composer (CMD+I),Server Client Logic,PROMPT: Setup Supabase SSR client for Next.js 16.1 using latest auth helpers and middleware. Configure shared authentication between Chrome Extension and Dashboard using cookies/tokens with same-site policies for cross-context persistence.,"Configuración de la autenticación con Supabase Auth utilizando el paquete SSR (Server-Side Rendering) para Next.js. Se implementan los 'auth helpers' y el middleware necesario para proteger las rutas privadas del Dashboard Web (panel administrativo secundario). CRÍTICO: La autenticación debe persistir entre la Extensión de Chrome (contexto principal) y el Dashboard Web mediante cookies compartidas o tokens con políticas same-site, permitiendo que el usuario autenticado en la Extensión pueda acceder al Dashboard sin re-autenticarse.",Media,"Lógica de seguridad crítica. GPT-5.2 es superior razonando sobre cookies, tokens y seguridad cross-site.",Usar MAX Mode para integrar auth en Web y Extensión. Cycle 2x para comparar dos implementaciones de seguridad y elegir la más robusta.,
5,Fase 1: Ingesta (El Ojo),2.01,02 Storage,Bucket de Expedientes,Alta,Listo,3.0,Dashboard AI,Secure Blob Storage,PROMPT: Create 'case-files' bucket in Supabase with RLS policies tied to auth.uid() in file metadata. Files are uploaded from Chrome Extension context.,Creación de Bucket 'case-files'. CAMBIO ESTRATEGIA: Se permite subida de PDFs tanto para usuarios FREE como PRO (Context Caching lo hace viable). RLS policies para asegurar aislamiento. Nota: Los archivos Free se etiquetan con metadata para borrado automático a los 7 días por el script 'The Reaper'.,Media,Excelente manejo de configuraciones de infraestructura y lectura de documentación técnica extensa.,Tarea aislada de configuración en Supabase. Gemini puede generar las políticas de Storage rápidamente.,
6,Fase 1: Ingesta (El Ojo),1.04,01 Cimientos,SQL: Perfiles & RLS,Alta,Listo,7.5,Dashboard AI,Multi-tenant Security,"PROMPT: SQL for 'profiles'. Columns: plan_type ('free'/'pro'), chat_count (int), deep_thinking_count (int), last_active_date (timestamp), device_fingerprint (text, unique constraint for free tier). RLS: Users can read/update own data. Admin can delete 'free' users.","ACTUALIZACIÓN MODELO PLANES (Feb 2026): Tabla profiles adaptada con contadores mensuales y Fair Use. 1) Plan Free ('Prueba Profesional' - 7 días): 1 Causa, 20 Chats (lifetime), 3 Deep Thinking (lifetime). Borrado 7 días. Ghost card: se conserva metadata de causa tras borrado. 2) Plan Pro ($50.00/mes): 500 Causas, Chat con Fair Use (soft cap 3,000/mes con throttle 30s), 100 Deep Thinking/mes. Columnas añadidas: monthly_chat_count, monthly_deep_thinking_count, monthly_reset_date. Incluye 'device_fingerprint' para evitar multicuentas y 'last_active' para The Reaper.",Alta,Requiere razonamiento profundo para diseñar un esquema de base de datos SQL seguro y escalable (RLS).,Primero usar modo 'Plan' para validar el esquema SQL. Luego 'Agent' para ejecutar la migración. MAX Mode necesario para ver tablas existentes.,
7,Fase 1: Ingesta (El Ojo),4.03,04 Scraper,Direct Upload API,Alta,Listo,6.0,API Routes,Secure Tunneling,PROMPT: Next.js 16 route to receive PDF blobs from Chrome Extension (main product) and stream directly to Supabase Storage.,Creación de un endpoint seguro (API Route) en Next.js diseñado para recibir 'blobs' (archivos binarios) directamente desde la Extensión de Chrome (interfaz principal). Este túnel permite que el Sidepanel suba los PDFs scrapeados del PJUD directamente al almacenamiento en la nube (Supabase) sin que el usuario tenga que guardarlos primero en su disco duro local. El flujo completo ocurre dentro del contexto del navegador: Scraping en PJUD → Upload desde Extensión → Storage en Supabase.,Media,"Manejo técnico preciso de streams, blobs y API Routes en Node.js/Next.js.",Requiere MAX Mode para alinear la API con el cliente de la Extensión. Codex asegura que el manejo de memoria sea óptimo.,
8,Fase 1: Ingesta (El Ojo),4.06,04 Scraper,Scraper Remote Config,Alta,Listo,3.0,API Routes,Dynamic Selectors,"PROMPT: Create Next.js API Route /api/scraper/config that serves a JSON with CSS selectors, URL patterns, and scraping rules. Extension fetches this config on startup. When PJud changes DOM, update server JSON and all extensions auto-fix in minutes without Chrome Store review.","Creación de un endpoint API (/api/scraper/config) que sirve la configuración dinámica del scraper: selectores CSS, patrones de URL para PDFs, keywords heurísticas y parámetros de throttling. SOLUCIÓN AL 'CICLO DE LA MUERTE' (Vulnerabilidad 4.1): Cuando PJud cambia su DOM, se actualiza este JSON en el servidor y TODAS las extensiones reciben los selectores corregidos en minutos, sin necesidad de pasar por la revisión de Google Chrome Store (que tarda hasta 4 días). La extensión cachea la config en chrome.storage.local como fallback offline, con defaults hardcodeados como último recurso. En producción, este JSON puede moverse a una tabla Supabase para edición via Dashboard admin.",Media,API Route con lógica de versionamiento y cache headers. Requiere precisión en la estructura del JSON de configuración.,Crear la API Route y el schema de configuración. MAX Mode para alinear los selectores con la estructura real del PJud.,
9,Fase 1: Ingesta (El Ojo),4.07,04 Scraper,Causa Context Detector (ROL Parser),Alta,Listo,5.0,Chrome API + DOM,Legal Context Awareness,"PROMPT: Build a context detector module for the Chrome Extension content script. It must: 1) Detect the ROL (Chilean legal case ID, format C-XXXXX-YYYY) from the current pjud.cl page by parsing URL, DOM text, breadcrumbs and navigation. 2) Identify the causa document zone (the table containing case files) vs generic page elements (help, menus, navigation). 3) Send detected ROL and causa info to Sidepanel for user confirmation BEFORE any scraping starts. No confirmation = no scraping.","TAREA MÁS CRÍTICA DEL BLOQUE SCRAPER. Módulo que detecta QUÉ causa jurídica está viendo el abogado ANTES de capturar un solo byte. Sin este contexto, el scraper sería un 'aspirador ciego' que captura cualquier PDF del sitio (ayuda, otras causas, documentos genéricos), contaminando la base de datos y confundiendo al RAG (3.02) con información cruzada entre causas. El módulo: 1) Parsea el ROL de la causa desde la URL, el texto del DOM, breadcrumbs y la ruta de navegación del PJud (formatos: C-XXXXX-YYYY, ROL: 12345-2026, etc.). 2) Identifica la 'zona de documentos' de la causa específica (tabla de escritos/resoluciones/actuaciones) diferenciándola de elementos genéricos de la página (menús, ayuda, FAQ). 3) Muestra al abogado en el Sidepanel: 'Causa C-12345-2026 - Juzgado Civil de Santiago - Carátula: Pérez con López - 15 documentos detectados'. 4) REQUIERE CONFIRMACIÓN EXPLÍCITA del abogado antes de permitir la sincronización. Sin ROL confirmado = sin scraping. En el mundo legal, un documento de otra causa es peor que ningún documento.",Alta,"Requiere razonamiento profundo sobre estructuras de navegación complejas del PJud, parsing de texto legal chileno y lógica condicional estricta.","Primero usar 'Plan' para mapear las diferentes vistas del PJud donde aparece el ROL (búsqueda, ficha de causa, detalle de expediente). Luego 'Agent' para implementar. Cycle 2x para verificar que no hay falsos positivos de ROL. MAX Mode obligatorio.",
10,Fase 1: Ingesta (El Ojo),4.08,04 Scraper,Scraper Resiliente Layers 1 & 2 (Red + DOM),Alta,Listo,8.0,Chrome API + webRequest,Resilient Scraping,"PROMPT: Implement 2-layer resilient scraper for Chrome Extension. Layer 1 (Network Interceptor): Inject script into page MAIN world to intercept fetch(), XMLHttpRequest and URL.createObjectURL(). Capture PDFs at HTTP traffic level, DOM-agnostic. Layer 2 (Smart DOM Analyzer): Heuristic scoring system finding download buttons by semantic meaning. Penetrates Shadow DOM and iframes. CRITICAL: Both layers scoped to confirmed causa context from 4.07. Layer 3 (Manual Drag-Drop): Fallback only when L1+L2 fail.","Motor de captura de PDFs con arquitectura de 3 capas y fallback automático, TODAS acotadas al contexto de causa confirmado por 4.07. LAYER 1 (Network Interceptor - Máxima Resiliencia): Inyecta script en el MAIN world de la página para interceptar fetch(), XMLHttpRequest y URL.createObjectURL(). Captura PDFs directamente del tráfico HTTP sin depender del DOM. Soluciona Vulnerabilidades 2.3 (Blobs) y 1.1 (Selectores frágiles). Si PJud cambia todo su HTML pero sigue sirviendo PDFs por HTTP, esta capa sigue funcionando. Solo se activa DESPUÉS de la confirmación de causa. LAYER 2 (Smart DOM Analyzer - Inmunidad al DOM): Sistema de puntuación heurístico que encuentra botones de descarga por significado semántico (texto 'descargar', iconos PDF, atributos onclick, contexto en tablas legales) en vez de selectores CSS frágiles. Penetra Shadow DOM recursivamente (Vuln. 1.3) e iframes same-origin (Vuln. 1.2). Solo opera dentro de la zona de documentos de la causa identificada por 4.07. LAYER 3 (Upload Manual): Drag & Drop de PDFs en el Sidepanel como último recurso. Solo aparece si Layer 1 y 2 no encuentran resultados.",Muy Alta,"Complejidad técnica extrema: interceptación de tráfico a nivel de página, inyección en MAIN world, heurísticas de scoring, traversal recursivo de Shadow DOM e iframes.",MAX Mode obligatorio para integrar con Context Detector (4.07) y config remota (4.06). Cycle 2x para verificar que no se capturan PDFs fuera del contexto de la causa confirmada.,
11,Fase 1: Ingesta (El Ojo),4.09,04 Scraper,PDF Validator & Causa Filter,Alta,Listo,4.0,Content Validation,Data Quality Gate,"PROMPT: Build validation pipeline for captured PDFs. Filters: 1) Size: reject <5KB and >100MB. 2) URL origin: must come from causa document section, not /ayuda/ or /manual/. 3) Content: verify %PDF magic bytes. 4) Deduplication: SHA-256 hash check against Supabase. 5) ROL tagging: tag every PDF with confirmed ROL, document type, and timestamp.","Puerta de validación entre la captura y el upload. Cada PDF capturado por las Layers 1 y 2 debe pasar esta cadena de filtros antes de subirse a Supabase. FILTRO 1 (Tamaño): Rechaza archivos menores a 5KB (probablemente iconos de ayuda o PDFs inline decorativos) y mayores a 100MB (corruptos o fuera de rango). FILTRO 2 (Origen URL): Verifica que la URL del PDF pertenezca a la sección de documentos de la causa, descartando PDFs de /ayuda/, /manual/, /faq/, /instrucciones/. FILTRO 3 (Contenido): Verifica los magic bytes '%PDF' al inicio del archivo. FILTRO 4 (Deduplicación): Calcula hash SHA-256 y lo compara contra documentos ya subidos para esa causa en Supabase, evitando duplicados. FILTRO 5 (ROL Tagging): Etiqueta cada PDF aprobado con el ROL confirmado, tipo de documento inferido (resolución, escrito, actuación, notificación), y timestamp de captura. Esta metadata es ESENCIAL para que el RAG (3.02) asocie correctamente cada documento a su causa sin contaminación cruzada.",Alta,"Lógica de validación crítica para integridad de datos. Un filtro mal calibrado contamina toda la cadena RAG. Requiere precisión en hashing, validación binaria y clasificación documental.","Cycle 2x obligatorio: primera pasada implementa filtros, segunda verifica con edge cases (PDFs de 1 byte, renombrados, duplicados con metadata distinta). MAX Mode para ver estructura de Storage.",
12,Fase 1: Ingesta (El Ojo),4.1,04 Scraper,Human Throttle & Anti-WAF,Alta,Listo,3.0,Chrome API,Bot Evasion,"PROMPT: Build client-side throttling module. Gaussian random delays (2.5-7s, Box-Muller), burst protection (max 5/min), single concurrent request, full mouse event simulation (mouseover/mousedown/mouseup/click with randomized coordinates), session jitter.",Sistema de timing client-side que hace indistinguible al scraper de un humano lento. SOLUCIÓN A Vulnerabilidades 3.1 (Rate Limiting/WAF) y 3.2 (Fingerprinting). DELAYS GAUSSIANOS: Distribución gaussiana (Box-Muller) centrada en ~4.5s con varianza natural (2.5-7s). Un Math.random() uniforme es detectable; la gaussiana imita timing humano real. BURST PROTECTION: Máximo 5 acciones por ventana de 60 segundos. CONCURRENCIA ÚNICA: 1 request a la vez. SIMULACIÓN DE MOUSE: Secuencia completa de eventos con coordenadas aleatorias. NOTA: Complementario a 4.04 (Rate Guard server-side). 4.10 protege la IP del estudio jurídico ante el WAF del PJud. 4.04 protege nuestro servidor ante bots externos.,Media,Implementación matemática (distribución gaussiana) y simulación de eventos DOM.,MAX Mode para integrarlo con el Strategy Engine (4.08) y asegurar que todas las acciones del scraper pasen por el throttle.,
13,Fase 1: Ingesta (El Ojo),4.11,04 Scraper,Sync UI & User Confirmation Flow,Alta,Listo,6.0,Composer Directo,One-Click UX,PROMPT: Update Extension Sidepanel with complete sync flow: 1) Auto-display detected ROL and causa info from 4.07. 2) Preview list of found documents. 3) User confirms with 'Sincronizar' button. 4) Real-time progress bar (Layer 1 → Layer 2 → Filtering → Upload). 5) Results summary. 6) Manual Drag-Drop zone only if automatic layers fail.,"Actualización del Sidepanel con el flujo completo de sincronización. PASO 1: Al navegar a una causa en pjud.cl, el Sidepanel muestra automáticamente: 'Causa C-12345-2026 - Juzgado Civil de Santiago - 15 documentos encontrados'. PASO 2: Preview de documentos agrupados por tipo (resoluciones, escritos, actuaciones). PASO 3: Abogado presiona 'Sincronizar' (UN SOLO CLICK). PASO 4: Barra de progreso: Captura (L1/L2) → Filtrado (4.09) → Validación → Upload (4.03). PASO 5: Resultado: '12/15 sincronizados (2 duplicados descartados, 1 rechazado por tamaño)'. PASO 6: Si L1+L2 fallan, aparece Drag & Drop (Layer 3). CLAVE UX: Aunque incluye confirmación de causa (el abogado ve qué se va a sincronizar), debe sentirse como fricción cero. La detección es automática; el botón es uno solo. El upload manual es un último recurso que ojalá nunca se use.",Alta,"UI compleja con múltiples estados (detección, preview, progreso, resultados, fallback). Sonnet es superior en UI/UX interactiva.",MAX Mode obligatorio para integrar con módulos 4.07-4.10 y mantener coherencia visual con el Sidepanel existente.,
14,Fase 2: Digestión (El Cerebro),3.01,03 Cerebro,Gemini 3.0 API Setup,Alta,Backlog,4.0,Secrets Management,Multimodal AI,PROMPT: Configure Google AI Studio SDK with dual model routing. Create server-side utility: gemini-3-flash for Fast Chat and gemini-3-pro for Deep Thinking. Single API key and SDK install. Model selection via config constant.,"Configuración del SDK Google AI (@google/generative-ai) con routing dual de modelos. ESTRATEGIA DE MODELOS (Benchmark Legal LM Arena Feb 2026): 1) Fast Chat → gemini-3-flash (Score Legal #1: 1510 puntos. Precio: $0.30/$2.50 por M tokens input/output). 2) Deep Thinking → gemini-3-pro con thinking mode habilitado (Score Legal #4: 1501 puntos. Precio: $2/$12 por M tokens input/output). JUSTIFICACIÓN ECONÓMICA: Con un solo modelo Pro para todo un usuario Pro pesado (1000 chats + 100 deep thinking) costaría ~$34.60/mes. Con Flash para chat el costo baja a ~$20/mes (margen 60% sobre $50/mes). Fair Use soft cap de 3,000 chats/mes protege contra usuarios extremos. IMPLEMENTACIÓN: Un solo paquete SDK una sola API key. El routing es una constante de configuración: mode === 'deep_thinking' ? 'gemini-3-pro' : 'gemini-3-flash'. Se crea utilidad server-side en src/lib/gemini.ts con función getModel(mode) que retorna la instancia correcta. Se elimina la lógica de enrutamiento complejo. La diferenciación de planes sigue siendo persistencia de datos (eterna vs 3 días) y cantidad de Deep Thinking.",Media,Conocimiento nativo de su propia API (Google AI SDK). Mejor para configuraciones de Vertex/Gemini.,Implementación de utilidad SDK. Tarea autocontenida.,
15,Fase 2: Digestión (El Cerebro),2.04,02 Storage,Supabase Vector Store,Alta,Backlog,4.0,Dashboard AI,Vector Embeddings,PROMPT: Enable pgvector extension and create 'document_embeddings' table. Optimized for legal text retrieval.,Habilitación de la extensión 'pgvector' en la base de datos Postgres de Supabase y creación de la tabla 'document_embeddings'. Esta tabla almacenará las representaciones vectoriales (embeddings) de los textos legales extraídos de los PDF. Es el cerebro de la búsqueda semántica que permitirá a la IA encontrar precedentes o párrafos específicos dentro de los expedientes.,Alta,Manejo de bases de datos grandes y extensiones específicas (pgvector). Contexto amplio útil para SQL complejos.,Configurar pgvector. Gemini puede inferir índices óptimos leyendo la estructura de datos definida en tareas anteriores.,
16,Fase 1: Ingesta (El Ojo),4.12,04 Scraper,SQL: Document Hashes Table,Alta,Backlog,2.0,Dashboard AI,Server-side Dedup,PROMPT: SQL migration for document_hashes table. Columns: user_id (uuid) rol (text) hash (text) filename (text) document_type (text) uploaded_at (timestamptz). RLS: Users read/insert own rows. UNIQUE(user_id hash).,Migración SQL para crear tabla 'document_hashes' en Supabase. Resuelve que la deduplicación de PDFs depende de chrome.storage.local (se pierde al cambiar PC / no funciona entre abogados del mismo estudio / se borra al limpiar navegador). La tabla almacena hash SHA-256 de cada PDF subido asociado a user_id y ROL. Permite: 1) Deduplicación server-side persistente. 2) Que dos abogados del mismo estudio no dupliquen documentos. 3) Que el PdfValidator (4.09) consulte hashes antes de subir. 4) Que el PDF Parser (4.02) registre hashes tras procesar. 5) Que la tarea 4.13 (Re-Sync Awareness) consulte hashes existentes para detectar documentos nuevos y calcular delta de sincronización. RLS: Cada usuario solo ve sus propios hashes. NOTA TÉCNICA: loadExistingHashes() en PdfValidator debe migrar de chrome.storage.local a consultar esta tabla y DEBE ser invocado al inicio de sync() en StrategyEngine para que la deduplicación funcione correctamente entre sesiones.,Media,Precisión en esquema SQL y políticas RLS. Complementa tabla profiles (1.04).,Migración SQL directa. MAX Mode para alinear con tabla profiles y bucket case-files existentes.,
17,Fase 3: Producción (El Escudo),4.02,04 Scraper,PDF Parsing Edge Fn,Media,Backlog,6.0,Edge Functions,OCR/Text Extraction,PROMPT: Implement PDF text extraction using pdf-parse or similar inside a Supabase Edge Function to avoid timeouts.,"Implementación de una Edge Function en Supabase dedicada al procesamiento de archivos PDF pesados. Dado que los expedientes pueden ser grandes, se utiliza una función Serverless (Edge) para extraer el texto plano de los PDFs subidos. Esto evita que el servidor principal se bloquee y permite escalar el procesamiento de múltiples documentos simultáneamente. ACTUALIZACIÓN POST-SCRAPER: Los PDFs ahora llegan pre-etiquetados con ROL y tipo de documento. El parser debe: 1) Propagar ROL y tipo como metadata del texto extraído. 2) Extraer número de folio si está presente en el contenido del PDF. 3) Registrar el hash SHA-256 en la tabla document_hashes (4.12) para deduplicación server-side persistente.",Alta,Ventana de contexto masiva ideal para procesar y entender estructuras de PDFs legales complejos.,Implementar función Edge. Gemini maneja bien la lógica de parsing de documentos grandes.,
18,Fase 2: Digestión (El Cerebro),3.02,03 Cerebro,RAG Pipeline Base,Alta,Backlog,10.0,Composer Max Mode,Context Retrieval,PROMPT: Implement RAG pipeline. Two modes: 1) 'Fast Chat' (Standard RAG) using gemini-3-flash. 2) 'Deep Thinking' (Agentic Chain of Thought) using gemini-3-pro with thinking mode. Both modes require ROL as mandatory context parameter.,Implementación del pipeline RAG. ACTUALIZACIÓN: Implementar dos modos. 1) 'Fast Chat': RAG estándar (Búsqueda + Respuesta) para consultas rápidas. 2) 'Deep Thinking' (Limitado): Agente autónomo con Chain of Thought que planifica pasos antes de responder exclusivo para usuarios con créditos disponibles. MODELOS DE PRODUCCIÓN (Feb 2026): Fast Chat invoca gemini-3-flash (Score Legal #1 en LM Arena: 1510 puntos. $0.30/$2.50 por M tokens. Menor latencia óptimo para respuestas rápidas). Deep Thinking invoca gemini-3-pro con thinking mode habilitado ($2/$12 por M tokens. Razonamiento más profundo ideal para Chain of Thought legal). Ambos modelos usan el mismo SDK configurado en 3.01; la selección se hace via getModel(mode). ACTUALIZACIÓN POST-SCRAPER: El RAG DEBE recibir el ROL como parámetro de contexto obligatorio. Al buscar embeddings filtrar SOLO por la causa consultada (ROL) para evitar contaminación cruzada entre causas. Cuando el abogado pregunte sobre una causa la IA responde exclusivamente con información de esa causa.,Muy Alta,El 'Cerebro' del sistema. Requiere máxima capacidad lógica para orquestar RAG y evitar alucinaciones.,Usar 'Plan' primero. Cycle 4x para generar 4 estrategias de RAG (ej. HyDE vs Vector simple) y elegir la mejor. MAX Mode obligatorio.,
19,Fase 1: Ingesta (El Ojo),4.13,04 Scraper,Re-Sync Awareness & Sync Incremental,Alta,Backlog,7.0,Composer Directo,Incremental Sync UX,PROMPT: Implement re-sync awareness in Extension Sidepanel. When user enters a previously synced causa: 1) Query document_hashes (4.12) for sync state. 2) Compare page documents vs stored hashes to find delta. 3) Show contextual UI based on sync state (new/synced/partial). 4) Show persistent AI context warning if docs missing. 5) Execute incremental sync (only new docs). 6) Fix loadExistingHashes() integration in StrategyEngine.sync().,FUNCIONALIDAD CRÍTICA PARA INTEGRIDAD DEL ANÁLISIS LEGAL CON IA. Cuando un abogado navega a una causa que YA fue sincronizada previamente el sistema actual ejecuta el mismo flujo que una causa nueva (detectar → confirmar → sincronizar todo). Esta tarea implementa consciencia de estado de sincronización previa y sync incremental real. PASO 1 (DETECCIÓN DE ESTADO PREVIO): Al detectar el ROL (4.07) consultar inmediatamente la tabla document_hashes (4.12) para obtener cuántos documentos ya están sincronizados para ese ROL y usuario. PASO 2 (CÁLCULO DE DELTA): Cruzar los documentos detectados en la página actual (preview de 4.07) contra los hashes almacenados. Calcular: docs_ya_sincronizados / docs_nuevos / docs_totales. PASO 3 (UI CONTEXTUAL EN SIDEPANEL - Tres estados): A) CAUSA NUEVA (0 hashes previos): Flujo normal de 4.11 sin cambios. B) CAUSA AL DÍA (delta = 0): Mostrar 'Causa C-XXXXX-YYYY sincronizada ✓ (N documentos). Todo al día.' con indicador verde. Botón Sincronizar deshabilitado o en modo 'Verificar'. C) CAUSA CON DOCUMENTOS NUEVOS (delta > 0): Mostrar 'Causa C-XXXXX-YYYY ya sincronizada (N docs). X documento(s) nuevo(s) disponible(s).' con indicador naranja/amarillo y botón prominente 'Sincronizar nuevos'. PASO 4 (ADVERTENCIA DE CONTEXTO INCOMPLETO - CRÍTICO LEGAL): Si existen documentos NO sincronizados mostrar advertencia prominente e imposible de ignorar junto a cualquier funcionalidad de IA (chat / editor de escritos / análisis): '⚠ ATENCIÓN: Existen X documento(s) de esta causa que NO han sido sincronizados. Las respuestas de la IA se basan en información INCOMPLETA. Una resolución adversa / un plazo fatal / un argumento de la contraparte podría estar en los documentos faltantes. Sincronice todos los documentos antes de tomar decisiones basadas en el análisis de IA.' Esta advertencia es ESENCIAL en el contexto legal: un abogado que consulta a la IA sin todo el expediente puede recibir un análisis que omite información crítica que podría cambiar completamente la estrategia del caso. La advertencia debe persistir visible mientras haya documentos pendientes de sincronización; NO puede ser descartada con un simple 'cerrar'. PASO 5 (SYNC INCREMENTAL REAL): El botón 'Sincronizar nuevos' ejecuta sync() con loadExistingHashes() precargado desde document_hashes (4.12) de modo que el PdfValidator (4.09) descarte automáticamente los ya subidos via hash SHA-256 y SOLO suba los documentos nuevos. Elimina re-transferencia innecesaria y acelera la sincronización. El resumen debe reflejar: 'X nuevos sincronizados (Y ya existían)'. PASO 6 (FIX GAP ACTUAL EN STRATEGY ENGINE): Integrar llamada a pdfValidator.loadExistingHashes(supabaseClient / userId / rol) al inicio de sync() en StrategyEngine. Actualmente esta función existe en PdfValidator pero NO se invoca en el flujo de sync lo que impide que la deduplicación funcione entre sesiones. Este fix es prerequisito para que el sync incremental funcione. DEPENDENCIAS: Requiere 4.12 (document_hashes table) / 4.07 (causa context detector) / 4.09 (pdf validator con loadExistingHashes) / 4.11 (sync UI base).,Alta,UI compleja con múltiples estados condicionales y lógica de comparación de hashes. Sonnet es óptimo para interfaces interactivas con estados dinámicos.,MAX Mode obligatorio para integrar con módulos 4.07 / 4.09 / 4.11 y 4.12 existentes. Cycle 2x: primera pasada implementa detección de estado y UI condicional; segunda verifica edge cases (causa con 0 docs nuevos / causa con docs parcialmente descargados / primera sincronización). Probar que la advertencia de contexto incompleto aparece consistentemente y no puede ser ignorada.,
20,Fase 1: Ingesta (El Ojo),5.01,05 Frontend,Vistas de Casos (Extensión + Dashboard),Alta,Backlog,12.5,Composer Directo,No-Upload UX,PROMPT: UI cases list for Sidepanel (primary) and Dashboard (secondary admin panel). Updates automatically when files are synced via Extension. Use React 19 useOptimistic hook for immediate feedback in the Sidepanel.,"Desarrollo de las vistas de listado de causas en DOS contextos: 1) VISTA PRINCIPAL en el Sidepanel de la Extensión de Chrome (donde el usuario trabaja diariamente), y 2) VISTA ADMINISTRATIVA en el Dashboard Web (para revisión y gestión desde escritorio). La clave es la sincronización en tiempo real: ambas interfaces deben actualizarse automáticamente (sin recargar) en cuanto la Extensión sube un nuevo expediente, utilizando las capacidades de suscripción a base de datos de Supabase o revalidación de Next.js. Se debe implementar el hook 'useOptimistic' de React 19 en el Sidepanel para mostrar el archivo en la lista inmediatamente mientras se sube en segundo plano. ACTUALIZACIÓN POST-SCRAPER: Cada PDF llega con metadata de ROL tribunal carátula y tipo de documento. La vista debe AGRUPAR documentos por causa (carpetas con ROL como título) y dentro de cada causa organizar por tipo (resoluciones escritos actuaciones notificaciones). No usar lista plana de archivos.",Muy Alta,"Complejidad alta de Frontend (Estado optimista, Sincronización Real-time). Sonnet brilla en React complejo.",MAX Mode crucial para ver tanto el código del Sidepanel como del Dashboard y unificar la lógica de visualización.,
21,Fase 2: Digestión (El Cerebro),3.03,03 Cerebro,Editor de Escritos con IA,Alta,Backlog,12.0,Composer Directo,AI Writing Assistant,"PROMPT: Create AI-assisted rich text editor using Tiptap/Slate. Features: 'Rewrite legalese', 'Expand argument'. Lives in Extension Sidepanel.","Desarrollo del editor de textos jurídicos potenciado por IA dentro del Sidepanel de la Extensión. Utilizando librerías como Tiptap o Slate.js, se crean funcionalidades específicas para abogados: un botón 'Reescribir formal', 'Expandir argumento jurídico', o 'Citar jurisprudencia'. El editor debe permitir la interacción fluida entre el texto que escribe el abogado y las sugerencias de la IA en tiempo real.",Muy Alta,Editor de texto rico (Rich Text) requiere manejo experto de DOM y UI interactiva compleja.,Cycle 4x para proponer diferentes UX de interacción IA-Abogado (ej. menú flotante vs sidebar). Sonnet implementa la ganadora.,
22,Fase 3: Producción (El Escudo),4.04,04 Scraper,Middleware: Limits & Rate Guard,Alta,Backlog,6.0,Chat (CMD+L),Backend Security,PROMPT: Next.js Middleware. 1) Rate Limit (Upstash/Redis) to block bots (e.g. 20 req/min). 2) Plan Limits: If Free & chat_count >= 20 -> Block. If Free & deep_thinking >= 3 -> Block. If Pro & monthly_chat >= 3000 -> Allow but apply 30s throttle (Fair Use). If Pro -> check monthly_deep_thinking < 100.,"Cerebro de control de acceso. Implementa: A) RATE LIMITING: Protección anti-bot/DDoS (ej. máx 20 req/min). B) LÓGICA DE NEGOCIO: Verifica contadores lifetime (FREE) y mensuales (PRO) en tabla 'profiles'. Bloquea usuarios Free que exceden sus 20 chats o 3 Deep Thinking. Para PRO: chat con Fair Use (soft cap 3,000/mes con throttle 30s, NO bloqueo). Deep Thinking PRO: hard cap 100/mes. C) FAIR USE: check_user_limits() retorna fair_use_throttle=true y throttle_ms=30000 cuando PRO supera 3,000 chats/mes. El middleware debe aplicar ese delay antes de procesar.",Media,Lógica de negocio sensible (Créditos/Dinero). Requiere precisión absoluta.,Implementar middleware de control. Cycle 2x para auditar posibles condiciones de carrera (race conditions) en el descuento de créditos.,
23,Fase 4: Extension Core (El Brazo),4.05,04 Auth Security,Fingerprinting Shield,Alta,Pendiente,3.0,React Hook,Browser Identity,"PROMPT: Integrate FingerprintJS in Next.js Auth flow. On Register/Login, generate visitorId. Check DB if visitorId exists in 'free' tier > 0 times. If exists, block creation of new free account. Force redirect to Pricing.","Sistema de defensa contra 'Multicuentas'. Genera un hash único del dispositivo del usuario (basado en navegador, OS, hardware). Si ese dispositivo ya consumió su 'Prueba Profesional de 7 días', bloquea el registro gratuito y muestra: 'Ya utilizaste tu período de prueba gratuita en este dispositivo. Actualiza a Pro para continuar.' Obliga a pagar el plan Pro ($50/mes). Esencial para proteger el modelo de negocio.",Media,Excelente lógica de frontend y seguridad.,Implementar en el componente de Auth de la Extensión.,
24,Fase 3: Producción (El Escudo),2.02,02 Storage,Privacy: Vertex 3 Logs,Alta,Backlog,1.5,GCP Config,Legal Compliance,REF: Disable data logging and model training in Vertex AI Gemini 3 settings for attorney-client privilege. Protects documents uploaded from Extension.,"Auditoría y configuración de privacidad en Google Cloud Platform (Vertex AI). Se deshabilitan explícitamente las opciones de 'Logging' y 'Training' para garantizar que Google no utilice los datos de las causas civiles procesadas (documentos subidos desde el Sidepanel de la Extensión) para entrenar sus modelos, protegiendo el privilegio abogado-cliente. Configuración crítica que asegura privacidad de documentos legales procesados desde el contexto del navegador.",Alta,Configuración específica de Google Cloud Platform.,Investigar primero con 'Ask' las opciones de privacidad de Vertex AI 2026. Luego aplicar configuración.,
25,Fase 2: Digestión (El Cerebro),2.05,02 Storage,The Reaper (Cron Job),Alta,Pendiente,2.0,SQL,pg_cron management,PROMPT: Create pg_cron job that runs every night. DELETE FROM storage.objects WHERE owner_id IN (SELECT id FROM profiles WHERE plan_type='free' AND last_active_date < NOW() - INTERVAL '7 days'). Reset case_count. PRESERVE profile row and causa metadata for ghost card.,"Implementación de la política 'Tierra Quemada' para usuarios Free. Script automatizado que elimina físicamente los PDFs y Vectores de cuentas gratuitas con más de 7 días (168 horas) de antigüedad. IMPORTANTE: NO eliminar la fila del perfil ni la metadata de causa (ROL, tribunal, carátula) — esto es la 'ghost card' que mantiene el dolor de pérdida y facilita la reconversión. Vital para mantener costos de storage cercanos a cero. Resetea case_count y contadores.",Media,Precisión en comandos destructivos SQL.,Testear query de selección primero con 'SELECT'. Luego implementar el DELETE dentro del cron job.,
26,Fase 3: Producción (El Escudo),6.01,06 Negocio,Stripe & Webhooks,Alta,Backlog,5.0,Stripe Dash,Automatic Billing,"REF: Enable Stripe Wrapper in Supabase. Map 'subscriptions' table directly to Stripe API. Subscription management happens in Dashboard Web (admin panel), but status is checked from Extension.",Configuración de pagos simplificada utilizando Supabase Stripe Wrappers. Un solo producto de suscripción recurrente ($50.00 USD/mes). Sin metered billing complejo. Al activar suscripción: actualizar plan_type='pro' y resetear contadores mensuales.,Alta,Integración financiera compleja (Stripe Wrappers).,Planificar mapeo de tablas primero. Cycle 2x para asegurar que la sincronización de estados de suscripción sea a prueba de fallos.,
27,Fase 3: Producción (El Escudo),5.02,05 Frontend,Landing Page (Venta),Media,Backlog,8.0,Composer Directo,Conversion UI,"PROMPT: Build high-conversion landing page with pricing sections, 'How it works', and Extension download link.",Diseño de Landing Page. ACTUALIZACIÓN PRECIOS (Feb 2026): Destacar propuesta 'Prueba Profesional'. Plan Free: 'Prueba de 7 días sin tarjeta - 20 consultas IA incluidas'. Plan Pro: '$50/mes - Poder Ilimitado'. Eliminar menciones a planes intermedios. Destacar valor: 'Menos de lo que cobras por media hora de trabajo'.,Baja,Mejor sentido estético para diseño web y Landing Pages de alta conversión.,"Generar 4 variantes de diseño visual con Cycle 4x. Elegir la más atractiva. Tarea aislada, no requiere MAX Mode.",
28,Fase 3: Producción (El Escudo),5.03,05 Frontend,Legal & Terms Pages,Baja,Backlog,2.0,Generador Textos,Compliance,"PROMPT: Create static pages for Terms of Service, Privacy Policy (Chrome Store requirement).",Creación de las páginas estáticas obligatorias para cualquier SaaS y extensión de Chrome: Términos de Servicio y Política de Privacidad. Son requisitos indispensables para que Google apruebe la publicación de la extensión en la Chrome Web Store. Deben ser accesibles públicamente.,Baja,Generación de texto formal y legal (Términos y condiciones) precisa.,Generación de contenido estático. Directo y rápido.,
29,Fase 3: Producción (El Escudo),6.03,06 Negocio,Privacy Consent Modal,Alta,Backlog,3.0,Composer Directo,Liability Protection,PROMPT: Modal in Extension Sidepanel on first causa confirmation (not first upload): 'I authorize page analysis and certify these are non-reserved civil documents'. Must appear BEFORE CausaContext (4.07) runs detection.,Implementación de una modal de consentimiento legal obligatoria en el Sidepanel de la Extensión (interfaz principal donde ocurre el primer uso). ACTUALIZACIÓN POST-SCRAPER: El modal debe aparecer ANTES DE LA PRIMERA CONFIRMACIÓN DE CAUSA (no antes del primer upload) ya que la detección de ROL implica leer contenido de la página del PJud. El usuario debe marcar casillas aceptando que: 1) Los documentos son causas civiles no reservadas. 2) Autoriza el análisis de la página del PJud para detectar información de la causa. 3) Reconoce que el procesamiento es realizado por IA. El consentimiento se captura antes de que la extensión analice cualquier dato del PJud.,Media,Componente de UI crítico (Modal) que requiere buena UX para no ser intrusivo.,Implementar modal en el Sidepanel. MAX Mode para asegurar que el estado de consentimiento persista correctamente.,
30,Fase 1: Ingesta (El Ojo),1.06,01 Cimientos,Next.js 'use cache' Setup,Alta,Backlog,4.0,Config Next.js,Performance 2026,PROMPT: Implement 'use cache' directive in server components to optimize case list fetching speed in both Sidepanel (via API) and Dashboard (secondary admin panel).,"Implementación de la directiva 'use cache' de Next.js (característica avanzada de la versión 16) en los componentes del servidor que sirven datos tanto al Sidepanel de la Extensión (mediante API Routes) como al Dashboard Web (panel administrativo). El objetivo es cachear agresivamente las listas de causas y datos estáticos para que la carga sea instantánea en ambos contextos, mejorando la experiencia de usuario frente a sistemas judiciales lentos. Prioridad en optimización del Sidepanel por ser la interfaz principal.",Media,Optimización de bajo nivel (Backend for Frontend). Requiere conocimiento técnico profundo de Next.js internals.,Analizar componentes existentes con MAX Mode para aplicar 'use cache' estratégicamente sin romper la revalidación.,
31,Fase 3: Producción (El Escudo),6.02,06 Negocio,Analytics PostHog,Baja,Backlog,2.0,NPM Install,User Behavior,"PROMPT: Integrate PostHog for user analytics. Track 'Case Uploaded', 'AI Query' events in both Web and Extension.","Integración de PostHog (u otra herramienta de analítica privacidad-friendly) para rastrear el comportamiento de los usuarios. Se definen eventos clave como 'Expediente subido', 'Consulta realizada a la IA', 'Error en scraping'. Esto permitirá entender cómo los abogados usan la herramienta y dónde se quedan atascados, tanto en la web como en la extensión.",Baja,Integración frontend limpia de librerías de analítica.,MAX Mode para inyectar eventos de analítica en los puntos clave de la app existente sin romper nada.,
32,Fase 2: Digestión (El Cerebro),3.04,03 Cerebro,Prompt Engineering Legal,Alta,Backlog,8.0,Prompting Manual,Legal Accuracy,"PROMPT: Develop and test system prompts for 'Juez Mode', 'Defensor Mode'. Optimize for Chilean law context. CRITICAL: Calibrate prompts for BOTH gemini-3-flash (Fast Chat) and gemini-3-pro (Deep Thinking) as they have different response characteristics.",Diseño prueba y refinamiento de los 'System Prompts' que guían a la IA. Se crean perfiles específicos como 'Modo Juez' (imparcial) 'Modo Defensor' (agresivo/estratégico) y se ajusta el contexto para que la IA entienda y utilice terminología jurídica chilena correcta. CALIBRACIÓN DUAL DE MODELOS: Los prompts deben probarse y ajustarse tanto en gemini-3-flash (Fast Chat) como en gemini-3-pro (Deep Thinking) ya que tienen características de respuesta diferentes. Flash tiende a respuestas más concisas y directas; Pro permite cadenas de razonamiento más largas y detalladas. Para Fast Chat: system prompts concisos que prioricen respuesta directa con cita de fuente (folio artículo). Para Deep Thinking: system prompts que incluyan instrucciones explícitas de Chain of Thought ('Analiza paso a paso: 1) Identifica el marco legal aplicable 2) Cita el artículo y folio relevante 3) Evalúa precedentes de la causa 4) Concluye con recomendación fundamentada'). Ambos modos deben respetar el filtro de ROL: responder SOLO con información de la causa consultada.,Alta,Superior en comprensión lingüística y matices para Prompt Engineering jurídico.,Iterar prompts con Cycle 4x para ver qué versión produce mejores respuestas legales. MAX Mode para que lea ejemplos de causas reales.,
